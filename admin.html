<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Tracking and Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        #admin-panel {
            margin-top: 20px;
        }

        .ip-list, .banned-ips-list {
            margin-top: 20px;
        }

        .banned {
            color: red;
        }
    </style>
</head>
<body>

<h1>IP Tracking and Admin Panel</h1>

<!-- IP Display Section -->
<p>Your IP Address: <span id="user-ip"></span></p>

<div id="admin-panel">
    <h2>Admin Panel</h2>
    
    <!-- Last IPs Section -->
    <h3>Last IPs:</h3>
    <div id="ip-list" class="ip-list"></div>
    
    <!-- IP Ban Section -->
    <h3>Ban an IP:</h3>
    <label for="ban-ip">Ban an IP:</label>
    <input type="text" id="ban-ip" placeholder="Enter IP to ban">
    <button onclick="banIP()">Ban IP</button>

    <h3>Banned IPs:</h3>
    <ul id="banned-ip-list" class="banned-ips-list"></ul>
    
    <h3>Unban an IP:</h3>
    <label for="unban-ip">Unban an IP:</label>
    <input type="text" id="unban-ip" placeholder="Enter IP to unban">
    <button onclick="unbanIP()">Unban IP</button>
</div>

<script>
// Global variables
const ipList = JSON.parse(localStorage.getItem("recentIPs")) || []; // Load recent IPs from localStorage
const bannedIPs = JSON.parse(localStorage.getItem("bannedIPs")) || []; // Load banned IPs from localStorage

// Fetch user IP and display it
function fetchAndLogIP() {
    fetch('https://checkip.amazonaws.com/')
        .then(response => response.text())
        .then(ip => {
            document.getElementById("user-ip").innerText = ip;
            logIP(ip); // Log the IP when it is fetched
            checkIfBanned(ip); // Check if this IP is banned
        })
        .catch(err => console.error('Failed to fetch IP:', err));
}

// Log IP and display it in the admin panel
function logIP(ip) {
    // Avoid duplicate IPs
    if (!ipList.includes(ip)) {
        ipList.push(ip);
        // Save the list of recent IPs to localStorage
        localStorage.setItem("recentIPs", JSON.stringify(ipList));
    }
    updateIPList(); // Update the IP list in the admin panel
}

// Check if the current user is banned
function checkIfBanned(currentUserIP) {
    if (bannedIPs.includes(currentUserIP)) {
        // Redirect to a "banned" page if the user is banned
        window.location.href = "/banned.html"; // Redirect to a page saying "You are banned"
    }
}

// Ban an IP address
function banIP() {
    const ipToBan = document.getElementById("ban-ip").value.trim();
    if (ipToBan && !bannedIPs.includes(ipToBan)) {
        bannedIPs.push(ipToBan);
        // Save banned IPs to localStorage
        localStorage.setItem("bannedIPs", JSON.stringify(bannedIPs));
        updateBannedIPList(); // Update the banned IP list in the admin panel
        alert(`IP ${ipToBan} has been banned!`);
    } else {
        alert('IP is already banned or invalid.');
    }
}

// Unban an IP address
function unbanIP() {
    const ipToUnban = document.getElementById("unban-ip").value.trim();
    const index = bannedIPs.indexOf(ipToUnban);
    if (index !== -1) {
        bannedIPs.splice(index, 1);
        // Save updated banned IPs to localStorage
        localStorage.setItem("bannedIPs", JSON.stringify(bannedIPs));
        updateBannedIPList(); // Update the banned IP list in the admin panel
        alert(`IP ${ipToUnban} has been unbanned!`);
    } else {
        alert('IP is not banned.');
    }
}

// Update the list of recently logged IPs in the admin panel
function updateIPList() {
    const ipListElement = document.getElementById("ip-list");
    ipListElement.innerHTML = ""; // Clear previous list

    ipList.forEach(ip => {
        const ipItem = document.createElement("div");
        ipItem.innerText = ip;
        ipListElement.appendChild(ipItem);
    });
}

// Update the banned IP list in the admin panel
function updateBannedIPList() {
    const bannedIPListElement = document.getElementById("banned-ip-list");
    bannedIPListElement.innerHTML = ""; // Clear previous list

    bannedIPs.forEach(ip => {
        const ipItem = document.createElement("li");
        ipItem.innerText = ip;
        ipItem.classList.add('banned');
        bannedIPListElement.appendChild(ipItem);
    });
}

// Initialize lists when page loads
fetchAndLogIP();
updateBannedIPList();

</script>

</body>
</html>
